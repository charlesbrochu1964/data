TYPE=VIEW
query=select `v_plan`.`plan_id` AS `plan_id`,`v_plan`.`objectif_id` AS `objectif_id`,`v_plan`.`code_wbs` AS `code_wbs`,`v_plan`.`niveau` AS `niveau`,`v_plan`.`poids` AS `poids`,`v_plan`.`type_objectif_libelle` AS `type_element_libelle`,`v_plan`.`type_objectif_code` AS `type_element_code`,`v_plan`.`type_objectif_classe` AS `type_element_classe`,`v_plan`.`libelle` AS `libelle`,`v_plan`.`attributs_desc` AS `attributs`,ifnull(concat(rtrim(`v_plan`.`responsable_nom`),\', \',`v_plan`.`responsable_prenom`),\'<nd>\') AS `responsable`,ifnull(`v_plan`.`responsable_departement_code`,\'<nd>\') AS `departement`,ifnull(`v_plan`.`responsable_direction_code`,\'<nd>\') AS `direction`,`v_plan`.`plan_code_wbs` AS `plan_code_wbs`,`v_plan`.`plan_libelle` AS `plan_libelle`,`v_plan`.`cible` AS `cible`,`v_plan`.`valeur_effectif_date` AS `valeur_effectif_date`,`v_plan`.`valeur` AS `valeur`,`v_plan`.`sens` AS `sens`,`v_plan`.`sens_no` AS `sens_no`,`v_plan`.`cible_ecart` AS `cible_ecart`,`v_plan`.`cible_completion` AS `cible_completion`,case when `v_plan`.`cible_completion` < 25 then \'  0 - 24 %\' when `v_plan`.`cible_completion` < 75 then \' 25 - 74 %\' when `v_plan`.`cible_completion` < 100 then \' 75 - 99 %\' when `v_plan`.`cible_completion` >= 100 then \'100 % +\' else \'nd\' end AS `cible_completion_statut`,`v_plan`.`decompte` AS `decompte`,`v_plan`.`termine_decompte` AS `termine_decompte`,`v_plan`.`termine_pourcent` / 100.0 AS `termine_pourcent`,`v_plan`.`completion_pourcent` / 100.0 AS `completion_pourcent`,`v_plan`.`completion_pourcent_total` AS `completion_pourcent_total`,case when `v_plan`.`completion_pourcent` < 25 then \'  0 - 24 %\' when `v_plan`.`completion_pourcent` < 75 then \' 25 - 74 %\' when `v_plan`.`completion_pourcent` < 100 then \' 75 - 99 %\' when `v_plan`.`completion_pourcent` >= 100 then \'100 % +\' else \'nd\' end AS `completion_statut`,`v_plan`.`reddition_debut_date` AS `reddition_debut_date`,`v_plan`.`reddition_fin_date` AS `reddition_fin_date`,`v_plan`.`duree` AS `duree`,`v_plan`.`jours_restants` AS `jours_restants`,`v_plan`.`cycle_pourcent` / 100.0 AS `cycle_pourcent`,case when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) < 5 * 365 then year(`v_plan`.`reddition_debut_date`) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) < 11 * 365 then concat(year(`v_plan`.`reddition_debut_date`),\'-\',year(`v_plan`.`reddition_debut_date` + interval 9 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) < 16 * 365 then concat(year(`v_plan`.`reddition_debut_date`),\'-\',year(`v_plan`.`reddition_debut_date` + interval 14 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) >= 16 * 365 then concat(year(`v_plan`.`reddition_debut_date`),\'+\') else \'nd\' end AS `debut_date_statut`,case when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) < 5 * 365 then year(`v_plan`.`reddition_fin_date`) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) < 11 * 365 then concat(year(`v_plan`.`reddition_fin_date`),\'-\',year(`v_plan`.`reddition_fin_date` + interval 9 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) < 16 * 365 then concat(year(`v_plan`.`reddition_fin_date`),\'-\',year(`v_plan`.`reddition_fin_date` + interval 14 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) >= 16 * 365 then concat(year(`v_plan`.`reddition_fin_date`),\'+\') else \'nd\' end AS `fin_date_statut`,case when `v_plan`.`statut_id` in (20,30) then case when `v_plan`.`debut_date` < `v_plan`.`reddition_debut_date` then \'Repoussé\' else \'En cours\' end when `v_plan`.`statut_id` = 40 then case when `v_plan`.`reddition_debut_date` <= `v_plan`.`debut_date` and `v_plan`.`reddition_fin_date` <= `v_plan`.`fin_date` then \'Respecté\' when `v_plan`.`reddition_debut_date` > `v_plan`.`debut_date` or `v_plan`.`reddition_fin_date` > `v_plan`.`fin_date` then \'Non-respecté\' end when `v_plan`.`statut_id` = 10 then \'Non-débuté\' else \'Non-applicable\' end AS `echeancier_statut`,`v_plan`.`budget_total` AS `budget_total`,`v_plan`.`budget_depense` AS `budget_depense`,`v_plan`.`budget_engage` AS `budget_engage`,`v_plan`.`budget_pourcent` / 100.0 AS `budget_pourcent`,`v_plan`.`statut` AS `statut`,`v_plan`.`reddition_date` AS `reddition_date`,`v_plan`.`budget_effectif_date` AS `budget_effectif_date`,`v_plan`.`codes_reddition_codes_desc` AS `codes_reddition`,case when exists(select 1 limit 1) then 1 else 0 end AS `ind_reddition_a_faire`,case when `v_plan`.`statut` = \'Retard\' then 1 else 0 end AS `ind_retard`,1 AS `occurence`,curdate() AS `maj_date` from `cbwebca_bd01`.`v_plan` where `v_plan`.`code_wbs` is not null order by `v_plan`.`code_wbs`
md5=676c1ae352168bc79013c255d6d41169
updatable=0
algorithm=0
definer_user=root
definer_host=localhost
suid=2
with_check_option=0
timestamp=2021-11-22 23:35:41
create-version=2
source=SELECT		v_plan.plan_id\n				,v_plan.objectif_id\n				,v_plan.code_wbs\n				,v_plan.niveau\n				,v_plan.poids\n				,v_plan.type_objectif_libelle AS type_element_libelle\n				,v_plan.type_objectif_code AS type_element_code\n				,v_plan.type_objectif_classe AS type_element_classe\n				,v_plan.libelle\n				,v_plan.attributs_desc AS attributs\n				,IFNULL( CONCAT( RTRIM( v_plan.responsable_nom ), \', \', v_plan.responsable_prenom ), \'<nd>\' ) AS responsable\n				,IFNULL( v_plan.responsable_departement_code, \'<nd>\' ) AS departement\n				,IFNULL( v_plan.responsable_direction_code, \'<nd>\' ) AS direction\n				\n				,v_plan.plan_code_wbs\n				,v_plan.plan_libelle\n\n				,v_plan.cible\n				,v_plan.valeur_effectif_date\n				,v_plan.valeur\n				,v_plan.sens\n				,v_plan.sens_no\n				,v_plan.cible_ecart\n				,v_plan.cible_completion\n\n				,CASE \n					WHEN v_plan.cible_completion < 25 THEN \'  0 - 24 %\'\n					WHEN v_plan.cible_completion < 75 THEN \' 25 - 74 %\'\n					WHEN v_plan.cible_completion < 100 THEN \' 75 - 99 %\'\n					WHEN v_plan.cible_completion >= 100 THEN \'100 % +\'\n					ELSE \'nd\'\n				END AS cible_completion_statut\n					\n				,v_plan.decompte\n				,v_plan.termine_decompte\n				,( v_plan.termine_pourcent / 100.0 ) AS termine_pourcent\n				,( v_plan.completion_pourcent / 100.0 ) AS completion_pourcent\n				,v_plan.completion_pourcent_total\n\n				,CASE \n					WHEN v_plan.completion_pourcent < 25 THEN \'  0 - 24 %\'\n					WHEN v_plan.completion_pourcent < 75 THEN \' 25 - 74 %\'\n					WHEN v_plan.completion_pourcent < 100 THEN \' 75 - 99 %\'\n					WHEN v_plan.completion_pourcent >= 100 THEN \'100 % +\'\n					ELSE \'nd\'\n				END AS completion_statut\n\n				,v_plan.reddition_debut_date\n				,v_plan.reddition_fin_date\n				,v_plan.duree\n				,v_plan.jours_restants\n				,( v_plan.cycle_pourcent / 100.0 ) AS cycle_pourcent\n\n				-- ,CASE\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 1 * 365 ) THEN YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 0 YEAR ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 2 * 365 ) THEN YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 1 YEAR ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 3 * 365 ) THEN YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 2 YEAR ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 4 * 365 ) THEN YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 3 YEAR ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 5 * 365 ) THEN YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 4 YEAR ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 11 * 365 ) THEN CONCAT( YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 5 YEAR ) ), \'-\', YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 9 YEAR ) ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) < ( 16 * 365 ) THEN CONCAT( YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 10 YEAR ) ), \'-\', YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 14 YEAR ) ) )\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_debut_date ) >= ( 16 * 365 ) THEN CONCAT( YEAR( DATE_ADD( v_plan.reddition_date, INTERVAL 15 YEAR ) ), \'+\' )\n				-- 	ELSE \'nd\'\n				-- END AS debut_date_statut\n\n				-- ,CASE\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_fin_date ) < ( 2 * 365 ) THEN \'0 - 2 ans\'\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_fin_date ) < ( 5 * 365 ) THEN \'2 - 5 ans\'\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_fin_date ) < ( 10 * 365 ) THEN \'5 - 10 ans\'\n				-- 	WHEN DATEDIFF( v_plan.reddition_date, v_plan.reddition_fin_date ) >= ( 10 * 365 ) THEN \'10 ans +\'\n				-- 	ELSE \'nd\'\n				-- END AS fin_date_statut\n\n				,CASE\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_debut_date ) < ( 5 * 365 ) THEN YEAR( v_plan.reddition_debut_date )\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_debut_date ) < ( 11 * 365 ) THEN CONCAT( YEAR( v_plan.reddition_debut_date ), \'-\', YEAR( DATE_ADD(  v_plan.reddition_debut_date, INTERVAL 9 YEAR ) ) )\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_debut_date ) < ( 16 * 365 ) THEN CONCAT( YEAR(  v_plan.reddition_debut_date ), \'-\', YEAR( DATE_ADD(  v_plan.reddition_debut_date, INTERVAL 14 YEAR ) ) )\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_debut_date ) >= ( 16 * 365 ) THEN CONCAT( YEAR(  v_plan.reddition_debut_date ), \'+\' )\n					ELSE \'nd\'\n				END AS debut_date_statut\n\n				,CASE\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_fin_date ) < ( 5 * 365 ) THEN YEAR( v_plan.reddition_fin_date )\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_fin_date ) < ( 11 * 365 ) THEN CONCAT( YEAR( v_plan.reddition_fin_date ), \'-\', YEAR( DATE_ADD(  v_plan.reddition_fin_date, INTERVAL 9 YEAR ) ) )\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_fin_date ) < ( 16 * 365 ) THEN CONCAT( YEAR( v_plan.reddition_fin_date ), \'-\', YEAR( DATE_ADD(  v_plan.reddition_fin_date, INTERVAL 14 YEAR ) ) )\n					WHEN DATEDIFF( IFNULL( v_plan.reddition_date, CURDATE() ), v_plan.reddition_fin_date ) >= ( 16 * 365 ) THEN CONCAT( YEAR( v_plan.reddition_fin_date ), \'+\' )\n					ELSE \'nd\'\n				END AS fin_date_statut\n\n				,CASE \n					WHEN v_plan.statut_id IN ( 20, 30 ) /* En cours, En retard */ THEN\n						CASE \n							WHEN v_plan.debut_date < v_plan.reddition_debut_date THEN \'Repoussé\' \n							ELSE \'En cours\'\n						END\n					WHEN v_plan.statut_id = 40 /*Terminé*/ THEN\n						CASE \n							WHEN v_plan.reddition_debut_date <= v_plan.debut_date AND v_plan.reddition_fin_date <= v_plan.fin_date THEN \'Respecté\'\n							WHEN !( v_plan.reddition_debut_date <= v_plan.debut_date AND v_plan.reddition_fin_date <= v_plan.fin_date ) THEN \'Non-respecté\'\n						END\n					WHEN v_plan.statut_id = 10 /* Non-débuté */ THEN \'Non-débuté\'\n					ELSE \'Non-applicable\'\n				END AS echeancier_statut\n\n				,v_plan.budget_total\n				,v_plan.budget_depense\n				,v_plan.budget_engage\n				,( v_plan.budget_pourcent / 100.0 ) AS budget_pourcent\n				\n				,v_plan.statut\n				,v_plan.reddition_date\n				,v_plan.budget_effectif_date\n				,v_plan.codes_reddition_codes_desc AS codes_reddition\n\n				,CASE WHEN EXISTS ( SELECT 1 /*FROM v_reddition_statut WHERE objectif_id = v_plan.objectif_id*/ ) THEN 1 ELSE 0 END AS ind_reddition_a_faire\n				,CASE WHEN v_plan.statut = \'Retard\' THEN 1 ELSE 0 END AS ind_retard\n\n				,1 AS occurence\n				\n				,CURDATE() AS maj_date\n\n	FROM		v_plan\n	WHERE		v_plan.code_wbs IS NOT NULL\n	ORDER BY	v_plan.code_wbs
client_cs_name=utf8mb4
connection_cl_name=utf8mb4_unicode_ci
view_body_utf8=select `v_plan`.`plan_id` AS `plan_id`,`v_plan`.`objectif_id` AS `objectif_id`,`v_plan`.`code_wbs` AS `code_wbs`,`v_plan`.`niveau` AS `niveau`,`v_plan`.`poids` AS `poids`,`v_plan`.`type_objectif_libelle` AS `type_element_libelle`,`v_plan`.`type_objectif_code` AS `type_element_code`,`v_plan`.`type_objectif_classe` AS `type_element_classe`,`v_plan`.`libelle` AS `libelle`,`v_plan`.`attributs_desc` AS `attributs`,ifnull(concat(rtrim(`v_plan`.`responsable_nom`),\', \',`v_plan`.`responsable_prenom`),\'<nd>\') AS `responsable`,ifnull(`v_plan`.`responsable_departement_code`,\'<nd>\') AS `departement`,ifnull(`v_plan`.`responsable_direction_code`,\'<nd>\') AS `direction`,`v_plan`.`plan_code_wbs` AS `plan_code_wbs`,`v_plan`.`plan_libelle` AS `plan_libelle`,`v_plan`.`cible` AS `cible`,`v_plan`.`valeur_effectif_date` AS `valeur_effectif_date`,`v_plan`.`valeur` AS `valeur`,`v_plan`.`sens` AS `sens`,`v_plan`.`sens_no` AS `sens_no`,`v_plan`.`cible_ecart` AS `cible_ecart`,`v_plan`.`cible_completion` AS `cible_completion`,case when `v_plan`.`cible_completion` < 25 then \'  0 - 24 %\' when `v_plan`.`cible_completion` < 75 then \' 25 - 74 %\' when `v_plan`.`cible_completion` < 100 then \' 75 - 99 %\' when `v_plan`.`cible_completion` >= 100 then \'100 % +\' else \'nd\' end AS `cible_completion_statut`,`v_plan`.`decompte` AS `decompte`,`v_plan`.`termine_decompte` AS `termine_decompte`,`v_plan`.`termine_pourcent` / 100.0 AS `termine_pourcent`,`v_plan`.`completion_pourcent` / 100.0 AS `completion_pourcent`,`v_plan`.`completion_pourcent_total` AS `completion_pourcent_total`,case when `v_plan`.`completion_pourcent` < 25 then \'  0 - 24 %\' when `v_plan`.`completion_pourcent` < 75 then \' 25 - 74 %\' when `v_plan`.`completion_pourcent` < 100 then \' 75 - 99 %\' when `v_plan`.`completion_pourcent` >= 100 then \'100 % +\' else \'nd\' end AS `completion_statut`,`v_plan`.`reddition_debut_date` AS `reddition_debut_date`,`v_plan`.`reddition_fin_date` AS `reddition_fin_date`,`v_plan`.`duree` AS `duree`,`v_plan`.`jours_restants` AS `jours_restants`,`v_plan`.`cycle_pourcent` / 100.0 AS `cycle_pourcent`,case when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) < 5 * 365 then year(`v_plan`.`reddition_debut_date`) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) < 11 * 365 then concat(year(`v_plan`.`reddition_debut_date`),\'-\',year(`v_plan`.`reddition_debut_date` + interval 9 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) < 16 * 365 then concat(year(`v_plan`.`reddition_debut_date`),\'-\',year(`v_plan`.`reddition_debut_date` + interval 14 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_debut_date`) >= 16 * 365 then concat(year(`v_plan`.`reddition_debut_date`),\'+\') else \'nd\' end AS `debut_date_statut`,case when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) < 5 * 365 then year(`v_plan`.`reddition_fin_date`) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) < 11 * 365 then concat(year(`v_plan`.`reddition_fin_date`),\'-\',year(`v_plan`.`reddition_fin_date` + interval 9 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) < 16 * 365 then concat(year(`v_plan`.`reddition_fin_date`),\'-\',year(`v_plan`.`reddition_fin_date` + interval 14 year)) when to_days(ifnull(`v_plan`.`reddition_date`,curdate())) - to_days(`v_plan`.`reddition_fin_date`) >= 16 * 365 then concat(year(`v_plan`.`reddition_fin_date`),\'+\') else \'nd\' end AS `fin_date_statut`,case when `v_plan`.`statut_id` in (20,30) then case when `v_plan`.`debut_date` < `v_plan`.`reddition_debut_date` then \'Repoussé\' else \'En cours\' end when `v_plan`.`statut_id` = 40 then case when `v_plan`.`reddition_debut_date` <= `v_plan`.`debut_date` and `v_plan`.`reddition_fin_date` <= `v_plan`.`fin_date` then \'Respecté\' when `v_plan`.`reddition_debut_date` > `v_plan`.`debut_date` or `v_plan`.`reddition_fin_date` > `v_plan`.`fin_date` then \'Non-respecté\' end when `v_plan`.`statut_id` = 10 then \'Non-débuté\' else \'Non-applicable\' end AS `echeancier_statut`,`v_plan`.`budget_total` AS `budget_total`,`v_plan`.`budget_depense` AS `budget_depense`,`v_plan`.`budget_engage` AS `budget_engage`,`v_plan`.`budget_pourcent` / 100.0 AS `budget_pourcent`,`v_plan`.`statut` AS `statut`,`v_plan`.`reddition_date` AS `reddition_date`,`v_plan`.`budget_effectif_date` AS `budget_effectif_date`,`v_plan`.`codes_reddition_codes_desc` AS `codes_reddition`,case when exists(select 1 limit 1) then 1 else 0 end AS `ind_reddition_a_faire`,case when `v_plan`.`statut` = \'Retard\' then 1 else 0 end AS `ind_retard`,1 AS `occurence`,curdate() AS `maj_date` from `cbwebca_bd01`.`v_plan` where `v_plan`.`code_wbs` is not null order by `v_plan`.`code_wbs`
mariadb-version=100508
