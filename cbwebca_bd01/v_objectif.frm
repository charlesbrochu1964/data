TYPE=VIEW
query=select `cbwebca_bd01`.`objectif`.`objectif_id` AS `objectif_id`,`cbwebca_bd01`.`objectif`.`code` AS `code`,`cbwebca_bd01`.`objectif`.`libelle` AS `libelle`,`cbwebca_bd01`.`objectif`.`descr` AS `descr`,`cbwebca_bd01`.`objectif`.`debut_date` AS `debut_date`,`cbwebca_bd01`.`objectif`.`fin_date` AS `fin_date`,`cbwebca_bd01`.`type_objectif`.`type_objectif_id` AS `type_objectif_id`,`cbwebca_bd01`.`type_objectif`.`code` AS `type_objectif_code`,`cbwebca_bd01`.`type_objectif`.`libelle` AS `type_objectif_libelle`,`cbwebca_bd01`.`type_objectif`.`css` AS `type_objectif_css`,`cbwebca_bd01`.`type_objectif`.`classe` AS `type_objectif_classe`,`cbwebca_bd01`.`personnel`.`personnel_id` AS `responsable_personnel_id`,`cbwebca_bd01`.`personnel`.`nom` AS `responsable_nom`,`cbwebca_bd01`.`personnel`.`prenom` AS `responsable_prenom`,`cbwebca_bd01`.`personnel`.`courriel` AS `responsable_courriel`,`cbwebca_bd01`.`departement`.`departement_id` AS `responsable_departement_id`,`cbwebca_bd01`.`departement`.`code` AS `responsable_departement_code`,`cbwebca_bd01`.`departement`.`direction_id` AS `responsable_direction_id`,`cbwebca_bd01`.`direction`.`code` AS `responsable_direction_code`,`cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id` AS `objectif_reddition_id`,`cbwebca_bd01`.`objectif_reddition`.`reddition_date` AS `reddition_date`,`cbwebca_bd01`.`objectif_reddition`.`debut_date` AS `reddition_debut_date`,`cbwebca_bd01`.`objectif_reddition`.`fin_date` AS `reddition_fin_date`,to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`debut_date`) AS `duree`,case when to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`) < 0 then 0 else to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`) end AS `jours_restants`,case when to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`) < 0 then 100 else round((to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`)) * 100 / (to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`debut_date`)),0) end AS `cycle_pourcent`,`cbwebca_bd01`.`objectif_reddition`.`ind_termine` AS `ind_termine`,`cbwebca_bd01`.`objectif_reddition`.`completion_pourcent` AS `completion_pourcent`,if(`cbwebca_bd01`.`objectif_reddition`.`z_statut_id` = 40,1,0) AS `termine_decompte`,`cbwebca_bd01`.`objectif_reddition`.`phase_id` AS `phase_id`,concat(\'[\',(select group_concat(json_object(\'code\',`cbwebca_bd01`.`code_reddition`.`code`,\'css\',`cbwebca_bd01`.`code_reddition`.`css`) separator \',\') from (`cbwebca_bd01`.`objectif_reddition_code` join `cbwebca_bd01`.`code_reddition` on(`cbwebca_bd01`.`code_reddition`.`code_reddition_id` = `cbwebca_bd01`.`objectif_reddition_code`.`code_reddition_id`)) where `cbwebca_bd01`.`objectif_reddition_code`.`objectif_reddition_id` = `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id`),\']\') AS `codes_reddition_codes`,(select group_concat(`cbwebca_bd01`.`code_reddition`.`code` separator \',\') from (`cbwebca_bd01`.`objectif_reddition_code` join `cbwebca_bd01`.`code_reddition` on(`cbwebca_bd01`.`code_reddition`.`code_reddition_id` = `cbwebca_bd01`.`objectif_reddition_code`.`code_reddition_id`)) where `cbwebca_bd01`.`objectif_reddition_code`.`objectif_reddition_id` = `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id`) AS `codes_reddition_codes_desc`,`objectif_budget`.`effectif_date` AS `budget_effectif_date`,`objectif_budget`.`budget_depense` AS `budget_depense`,`objectif_budget`.`budget_engage` AS `budget_engage`,`objectif_budget`.`budget_total` AS `budget_total`,round((`objectif_budget`.`budget_depense` + `objectif_budget`.`budget_engage`) * 100 / `objectif_budget`.`budget_total`,0) AS `budget_pourcent`,`cbwebca_bd01`.`objectif_valeur`.`cible` AS `cible`,`cbwebca_bd01`.`objectif_valeur`.`sens` AS `sens`,`cbwebca_bd01`.`objectif_valeur`.`valeur` AS `valeur`,`cbwebca_bd01`.`objectif_valeur`.`effectif_date` AS `valeur_effectif_date`,round(if(`cbwebca_bd01`.`objectif_valeur`.`sens` = \'Bas\',`cbwebca_bd01`.`objectif_valeur`.`cible` - `cbwebca_bd01`.`objectif_valeur`.`valeur`,`cbwebca_bd01`.`objectif_valeur`.`valeur` - `cbwebca_bd01`.`objectif_valeur`.`cible`) * 100 / `cbwebca_bd01`.`objectif_valeur`.`cible`,0) AS `cible_ecart`,round(`cbwebca_bd01`.`objectif_valeur`.`valeur` * 100 / `cbwebca_bd01`.`objectif_valeur`.`cible`,0) AS `cible_completion`,concat(\'[\',(select group_concat(json_object(\'code\',`cbwebca_bd01`.`attribut`.`code`,\'css\',`cbwebca_bd01`.`attribut`.`css`) separator \',\') from (`cbwebca_bd01`.`objectif_attribut` left join `cbwebca_bd01`.`attribut` on(`cbwebca_bd01`.`attribut`.`attribut_id` = `cbwebca_bd01`.`objectif_attribut`.`attribut_id`)) where `cbwebca_bd01`.`objectif_attribut`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`),\']\') AS `attributs`,(select group_concat(`cbwebca_bd01`.`attribut`.`code` separator \',\') from (`cbwebca_bd01`.`objectif_attribut` left join `cbwebca_bd01`.`attribut` on(`cbwebca_bd01`.`attribut`.`attribut_id` = `cbwebca_bd01`.`objectif_attribut`.`attribut_id`)) where `cbwebca_bd01`.`objectif_attribut`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `attributs_desc`,`cbwebca_bd01`.`statut`.`statut_id` AS `statut_id`,`cbwebca_bd01`.`statut`.`css` AS `statut_css`,`cbwebca_bd01`.`statut`.`icone` AS `statut_icone`,`cbwebca_bd01`.`statut`.`libelle` AS `statut`,(select count(0) from `cbwebca_bd01`.`objectif_attribut` where `cbwebca_bd01`.`objectif_attribut`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `attribut_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_personnel` where `cbwebca_bd01`.`objectif_personnel`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `personnel_decompte`,(select count(0) from `cbwebca_bd01`.`plan` where `cbwebca_bd01`.`plan`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `plan_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_valeur` where `cbwebca_bd01`.`objectif_valeur`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `valeur_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_budget` where `cbwebca_bd01`.`objectif_budget`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `budget_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_reddition` where `cbwebca_bd01`.`objectif_reddition`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `reddition_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_suivi` where `cbwebca_bd01`.`objectif_suivi`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `suivi_decompte`,(select count(0) from (`cbwebca_bd01`.`plan` join `cbwebca_bd01`.`plan` `enfant` on(`enfant`.`parent_id` = `cbwebca_bd01`.`plan`.`plan_id`)) where `enfant`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `plan_parent_decompte`,(select count(0) from (`cbwebca_bd01`.`plan` join `cbwebca_bd01`.`plan` `enfant` on(`enfant`.`parent_id` = `cbwebca_bd01`.`plan`.`plan_id`)) where `cbwebca_bd01`.`plan`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `plan_enfant_decompte`,1 AS `decompte` from (((((((((`cbwebca_bd01`.`objectif` join `cbwebca_bd01`.`type_objectif` on(`cbwebca_bd01`.`type_objectif`.`type_objectif_id` = `cbwebca_bd01`.`objectif`.`type_objectif_id`)) left join `cbwebca_bd01`.`objectif_personnel` on(`cbwebca_bd01`.`objectif_personnel`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` and `cbwebca_bd01`.`objectif_personnel`.`responsabilite` = \'R\')) left join `cbwebca_bd01`.`personnel` on(`cbwebca_bd01`.`personnel`.`personnel_id` = `cbwebca_bd01`.`objectif_personnel`.`personnel_id`)) left join `cbwebca_bd01`.`departement` on(`cbwebca_bd01`.`departement`.`departement_id` = `cbwebca_bd01`.`personnel`.`departement_id`)) left join `cbwebca_bd01`.`direction` on(`cbwebca_bd01`.`direction`.`direction_id` = `cbwebca_bd01`.`departement`.`direction_id`)) left join `cbwebca_bd01`.`objectif_valeur` on(`cbwebca_bd01`.`objectif_valeur`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` and `cbwebca_bd01`.`objectif_valeur`.`objectif_valeur_id` = (select `cbwebca_bd01`.`objectif_valeur`.`objectif_valeur_id` from `cbwebca_bd01`.`objectif_valeur` where `cbwebca_bd01`.`objectif_valeur`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` order by `cbwebca_bd01`.`objectif_valeur`.`effectif_date` desc limit 1))) left join `cbwebca_bd01`.`v_objectif_budget_par_objectif` `objectif_budget` on(`objectif_budget`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`)) left join `cbwebca_bd01`.`objectif_reddition` on(`cbwebca_bd01`.`objectif_reddition`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` and `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id` = (select `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id` from `cbwebca_bd01`.`objectif_reddition` where `cbwebca_bd01`.`objectif_reddition`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` order by `cbwebca_bd01`.`objectif_reddition`.`reddition_date` desc limit 1))) left join `cbwebca_bd01`.`statut` on(`cbwebca_bd01`.`statut`.`statut_id` = `cbwebca_bd01`.`objectif_reddition`.`z_statut_id`)) order by `cbwebca_bd01`.`type_objectif`.`code`,`cbwebca_bd01`.`objectif`.`code`
md5=12ab874d58d2234aa6c005366137e64f
updatable=0
algorithm=0
definer_user=root
definer_host=localhost
suid=2
with_check_option=0
timestamp=2021-11-22 22:45:21
create-version=2
source=SELECT		objectif.objectif_id\n				,objectif.code\n				,objectif.libelle\n				,objectif.descr\n				,objectif.debut_date\n				,objectif.fin_date\n\n				/* Type et classe */\n				,type_objectif.type_objectif_id\n                ,type_objectif.code AS type_objectif_code\n                ,type_objectif.libelle AS type_objectif_libelle\n                ,type_objectif.css AS type_objectif_css\n				,type_objectif.classe AS type_objectif_classe\n\n				/* Responsable */\n				,personnel.personnel_id AS responsable_personnel_id\n                ,personnel.nom AS responsable_nom\n                ,personnel.prenom AS responsable_prenom\n				,personnel.courriel AS responsable_courriel\n				,departement.departement_id AS responsable_departement_id\n                ,departement.code AS responsable_departement_code\n				,departement.direction_id AS responsable_direction_id\n                ,direction.code AS responsable_direction_code\n\n				/* Reddition */\n                ,objectif_reddition.objectif_reddition_id\n                ,objectif_reddition.reddition_date\n\n               	,objectif_reddition.debut_date AS reddition_debut_date\n                ,objectif_reddition.fin_date AS reddition_fin_date\n				,DATEDIFF( objectif_reddition.fin_date, objectif_reddition.debut_date ) AS duree\n\n				,CASE \n					WHEN DATEDIFF( objectif_reddition.fin_date, objectif_reddition.reddition_date ) < 0 THEN 0\n					ELSE DATEDIFF( objectif_reddition.fin_date, objectif_reddition.reddition_date )\n				END AS jours_restants\n\n                ,CASE \n					WHEN DATEDIFF( objectif_reddition.fin_date, objectif_reddition.reddition_date ) < 0 THEN 100\n					ELSE ROUND(	DATEDIFF( objectif_reddition.fin_date, objectif_reddition.reddition_date ) * 100 / DATEDIFF( objectif_reddition.fin_date, objectif_reddition.debut_date ), 0 ) \n				END AS cycle_pourcent\n\n				,objectif_reddition.ind_termine\n\n\n                ,objectif_reddition.completion_pourcent AS completion_pourcent\n                ,IF( objectif_reddition.z_statut_id = 40, 1, 0 ) AS termine_decompte\n\n				,objectif_reddition.phase_id\n\n				/* Codes de reddition */\n				,CONCAT( \'[\', (	SELECT		GROUP_CONCAT( JSON_OBJECT( \'code\', code_reddition.code, \'css\', code_reddition.css ) )\n								FROM		objectif_reddition_code\n                    			JOIN        code_reddition ON code_reddition.code_reddition_id = objectif_reddition_code.code_reddition_id\n								WHERE		objectif_reddition_code.objectif_reddition_id = objectif_reddition.objectif_reddition_id ), \']\' ) AS codes_reddition_codes\n\n				,(	SELECT		GROUP_CONCAT( code_reddition.code )\n					FROM		objectif_reddition_code\n                	JOIN        code_reddition ON code_reddition.code_reddition_id = objectif_reddition_code.code_reddition_id\n					WHERE		objectif_reddition_code.objectif_reddition_id = objectif_reddition.objectif_reddition_id ) AS codes_reddition_codes_desc\n\n				/* Budget */\n				,objectif_budget.effectif_date AS budget_effectif_date\n				,objectif_budget.budget_depense\n				,objectif_budget.budget_engage\n				,objectif_budget.budget_total\n                ,ROUND( ( objectif_budget.budget_depense + objectif_budget.budget_engage ) * 100 / objectif_budget.budget_total, 0 ) AS budget_pourcent\n\n				/* Indicateur */\n				,objectif_valeur.cible\n				,objectif_valeur.sens\n				,objectif_valeur.valeur\n				,objectif_valeur.effectif_date AS valeur_effectif_date\n                ,ROUND( IF( objectif_valeur.sens = \'Bas\', objectif_valeur.cible - objectif_valeur.valeur, objectif_valeur.valeur - objectif_valeur.cible ) * 100 / objectif_valeur.cible, 0 ) AS cible_ecart\n                ,ROUND( ( objectif_valeur.valeur * 100 ) / objectif_valeur.cible, 0 ) AS cible_completion\n\n				/* Attributs */\n				,CONCAT( \'[\', (	SELECT		GROUP_CONCAT( JSON_OBJECT( \'code\', attribut.code, \'css\', attribut.css ) )\n								FROM		objectif_attribut\n								LEFT JOIN	attribut ON attribut.attribut_id = objectif_attribut.attribut_id\n								WHERE		objectif_attribut.objectif_id = objectif.objectif_id ), \']\' ) AS attributs \n\n				,(	SELECT		GROUP_CONCAT( attribut.code )\n					FROM		objectif_attribut\n					LEFT JOIN	attribut ON attribut.attribut_id = objectif_attribut.attribut_id\n					WHERE		objectif_attribut.objectif_id = objectif.objectif_id ) AS attributs_desc \n\n				/* Statut */\n				,statut.statut_id\n               	,statut.css AS statut_css\n				,statut.icone AS statut_icone\n               	,statut.libelle AS statut\n\n				/* Décompte */\n                ,( SELECT COUNT(*) FROM objectif_attribut WHERE objectif_id = objectif.objectif_id ) AS attribut_decompte\n                ,( SELECT COUNT(*) FROM objectif_personnel WHERE objectif_id = objectif.objectif_id ) AS personnel_decompte\n                ,( SELECT COUNT(*) FROM plan WHERE objectif_id = objectif.objectif_id ) AS plan_decompte\n                ,( SELECT COUNT(*) FROM objectif_valeur WHERE objectif_id = objectif.objectif_id ) AS valeur_decompte\n                ,( SELECT COUNT(*) FROM objectif_budget WHERE objectif_id = objectif.objectif_id ) AS budget_decompte\n                ,( SELECT COUNT(*) FROM objectif_reddition WHERE objectif_id = objectif.objectif_id ) AS reddition_decompte\n                ,( SELECT COUNT(*) FROM objectif_suivi WHERE objectif_id = objectif.objectif_id ) AS suivi_decompte\n				,( SELECT COUNT(*) FROM plan JOIN plan AS enfant ON enfant.parent_id = plan.plan_id WHERE enfant.objectif_id = objectif.objectif_id ) AS plan_parent_decompte\n				,( SELECT COUNT(*) FROM plan JOIN plan AS enfant ON enfant.parent_id = plan.plan_id WHERE plan.objectif_id = objectif.objectif_id ) AS plan_enfant_decompte\n\n				,1 AS decompte\n\n	FROM		objectif\n    JOIN        type_objectif           ON  type_objectif.type_objectif_id = objectif.type_objectif_id\n\n	/* Pas de danger d\'avoir des doublons car index unique sur responsable */\n	LEFT JOIN	objectif_personnel		ON 	objectif_personnel.objectif_id = objectif.objectif_id AND responsabilite = \'R\' \n	LEFT JOIN	personnel				ON	personnel.personnel_id = objectif_personnel.personnel_id\n	LEFT JOIN   departement             ON  departement.departement_id = personnel.departement_id\n	LEFT JOIN   direction             	ON  direction.direction_id = departement.direction_id\n\n	/* dernière valeur pour un indicateur */\n    LEFT JOIN   objectif_valeur      	ON  objectif_valeur.objectif_id = objectif.objectif_id AND\n                                            objectif_valeur.objectif_valeur_id = (	SELECT      objectif_valeur.objectif_valeur_id\n																					FROM        objectif_valeur\n																					WHERE       objectif_valeur.objectif_id = objectif.objectif_id\n																					ORDER BY    objectif_valeur.effectif_date DESC\n																					LIMIT       1 )\n\n	/* dernier état du budget */\n    LEFT JOIN   v_objectif_budget_par_objectif AS objectif_budget      	ON  objectif_budget.objectif_id = objectif.objectif_id\n\n	/* dernière reddition */\n    LEFT JOIN   objectif_reddition      ON  objectif_reddition.objectif_id = objectif.objectif_id AND\n                                            objectif_reddition.objectif_reddition_id =  (	SELECT      objectif_reddition.objectif_reddition_id\n																							FROM        objectif_reddition\n																							WHERE       objectif_reddition.objectif_id = objectif.objectif_id\n																							ORDER BY    objectif_reddition.reddition_date DESC\n																							LIMIT       1 )\n\n	LEFT JOIN	statut					ON	statut.statut_id = objectif_reddition.z_statut_id\n\n	ORDER BY	type_objectif.code,\n                objectif.code
client_cs_name=utf8mb4
connection_cl_name=utf8mb4_unicode_ci
view_body_utf8=select `cbwebca_bd01`.`objectif`.`objectif_id` AS `objectif_id`,`cbwebca_bd01`.`objectif`.`code` AS `code`,`cbwebca_bd01`.`objectif`.`libelle` AS `libelle`,`cbwebca_bd01`.`objectif`.`descr` AS `descr`,`cbwebca_bd01`.`objectif`.`debut_date` AS `debut_date`,`cbwebca_bd01`.`objectif`.`fin_date` AS `fin_date`,`cbwebca_bd01`.`type_objectif`.`type_objectif_id` AS `type_objectif_id`,`cbwebca_bd01`.`type_objectif`.`code` AS `type_objectif_code`,`cbwebca_bd01`.`type_objectif`.`libelle` AS `type_objectif_libelle`,`cbwebca_bd01`.`type_objectif`.`css` AS `type_objectif_css`,`cbwebca_bd01`.`type_objectif`.`classe` AS `type_objectif_classe`,`cbwebca_bd01`.`personnel`.`personnel_id` AS `responsable_personnel_id`,`cbwebca_bd01`.`personnel`.`nom` AS `responsable_nom`,`cbwebca_bd01`.`personnel`.`prenom` AS `responsable_prenom`,`cbwebca_bd01`.`personnel`.`courriel` AS `responsable_courriel`,`cbwebca_bd01`.`departement`.`departement_id` AS `responsable_departement_id`,`cbwebca_bd01`.`departement`.`code` AS `responsable_departement_code`,`cbwebca_bd01`.`departement`.`direction_id` AS `responsable_direction_id`,`cbwebca_bd01`.`direction`.`code` AS `responsable_direction_code`,`cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id` AS `objectif_reddition_id`,`cbwebca_bd01`.`objectif_reddition`.`reddition_date` AS `reddition_date`,`cbwebca_bd01`.`objectif_reddition`.`debut_date` AS `reddition_debut_date`,`cbwebca_bd01`.`objectif_reddition`.`fin_date` AS `reddition_fin_date`,to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`debut_date`) AS `duree`,case when to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`) < 0 then 0 else to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`) end AS `jours_restants`,case when to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`) < 0 then 100 else round((to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`reddition_date`)) * 100 / (to_days(`cbwebca_bd01`.`objectif_reddition`.`fin_date`) - to_days(`cbwebca_bd01`.`objectif_reddition`.`debut_date`)),0) end AS `cycle_pourcent`,`cbwebca_bd01`.`objectif_reddition`.`ind_termine` AS `ind_termine`,`cbwebca_bd01`.`objectif_reddition`.`completion_pourcent` AS `completion_pourcent`,if(`cbwebca_bd01`.`objectif_reddition`.`z_statut_id` = 40,1,0) AS `termine_decompte`,`cbwebca_bd01`.`objectif_reddition`.`phase_id` AS `phase_id`,concat(\'[\',(select group_concat(json_object(\'code\',`cbwebca_bd01`.`code_reddition`.`code`,\'css\',`cbwebca_bd01`.`code_reddition`.`css`) separator \',\') from (`cbwebca_bd01`.`objectif_reddition_code` join `cbwebca_bd01`.`code_reddition` on(`cbwebca_bd01`.`code_reddition`.`code_reddition_id` = `cbwebca_bd01`.`objectif_reddition_code`.`code_reddition_id`)) where `cbwebca_bd01`.`objectif_reddition_code`.`objectif_reddition_id` = `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id`),\']\') AS `codes_reddition_codes`,(select group_concat(`cbwebca_bd01`.`code_reddition`.`code` separator \',\') from (`cbwebca_bd01`.`objectif_reddition_code` join `cbwebca_bd01`.`code_reddition` on(`cbwebca_bd01`.`code_reddition`.`code_reddition_id` = `cbwebca_bd01`.`objectif_reddition_code`.`code_reddition_id`)) where `cbwebca_bd01`.`objectif_reddition_code`.`objectif_reddition_id` = `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id`) AS `codes_reddition_codes_desc`,`objectif_budget`.`effectif_date` AS `budget_effectif_date`,`objectif_budget`.`budget_depense` AS `budget_depense`,`objectif_budget`.`budget_engage` AS `budget_engage`,`objectif_budget`.`budget_total` AS `budget_total`,round((`objectif_budget`.`budget_depense` + `objectif_budget`.`budget_engage`) * 100 / `objectif_budget`.`budget_total`,0) AS `budget_pourcent`,`cbwebca_bd01`.`objectif_valeur`.`cible` AS `cible`,`cbwebca_bd01`.`objectif_valeur`.`sens` AS `sens`,`cbwebca_bd01`.`objectif_valeur`.`valeur` AS `valeur`,`cbwebca_bd01`.`objectif_valeur`.`effectif_date` AS `valeur_effectif_date`,round(if(`cbwebca_bd01`.`objectif_valeur`.`sens` = \'Bas\',`cbwebca_bd01`.`objectif_valeur`.`cible` - `cbwebca_bd01`.`objectif_valeur`.`valeur`,`cbwebca_bd01`.`objectif_valeur`.`valeur` - `cbwebca_bd01`.`objectif_valeur`.`cible`) * 100 / `cbwebca_bd01`.`objectif_valeur`.`cible`,0) AS `cible_ecart`,round(`cbwebca_bd01`.`objectif_valeur`.`valeur` * 100 / `cbwebca_bd01`.`objectif_valeur`.`cible`,0) AS `cible_completion`,concat(\'[\',(select group_concat(json_object(\'code\',`cbwebca_bd01`.`attribut`.`code`,\'css\',`cbwebca_bd01`.`attribut`.`css`) separator \',\') from (`cbwebca_bd01`.`objectif_attribut` left join `cbwebca_bd01`.`attribut` on(`cbwebca_bd01`.`attribut`.`attribut_id` = `cbwebca_bd01`.`objectif_attribut`.`attribut_id`)) where `cbwebca_bd01`.`objectif_attribut`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`),\']\') AS `attributs`,(select group_concat(`cbwebca_bd01`.`attribut`.`code` separator \',\') from (`cbwebca_bd01`.`objectif_attribut` left join `cbwebca_bd01`.`attribut` on(`cbwebca_bd01`.`attribut`.`attribut_id` = `cbwebca_bd01`.`objectif_attribut`.`attribut_id`)) where `cbwebca_bd01`.`objectif_attribut`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `attributs_desc`,`cbwebca_bd01`.`statut`.`statut_id` AS `statut_id`,`cbwebca_bd01`.`statut`.`css` AS `statut_css`,`cbwebca_bd01`.`statut`.`icone` AS `statut_icone`,`cbwebca_bd01`.`statut`.`libelle` AS `statut`,(select count(0) from `cbwebca_bd01`.`objectif_attribut` where `cbwebca_bd01`.`objectif_attribut`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `attribut_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_personnel` where `cbwebca_bd01`.`objectif_personnel`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `personnel_decompte`,(select count(0) from `cbwebca_bd01`.`plan` where `cbwebca_bd01`.`plan`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `plan_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_valeur` where `cbwebca_bd01`.`objectif_valeur`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `valeur_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_budget` where `cbwebca_bd01`.`objectif_budget`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `budget_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_reddition` where `cbwebca_bd01`.`objectif_reddition`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `reddition_decompte`,(select count(0) from `cbwebca_bd01`.`objectif_suivi` where `cbwebca_bd01`.`objectif_suivi`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `suivi_decompte`,(select count(0) from (`cbwebca_bd01`.`plan` join `cbwebca_bd01`.`plan` `enfant` on(`enfant`.`parent_id` = `cbwebca_bd01`.`plan`.`plan_id`)) where `enfant`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `plan_parent_decompte`,(select count(0) from (`cbwebca_bd01`.`plan` join `cbwebca_bd01`.`plan` `enfant` on(`enfant`.`parent_id` = `cbwebca_bd01`.`plan`.`plan_id`)) where `cbwebca_bd01`.`plan`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`) AS `plan_enfant_decompte`,1 AS `decompte` from (((((((((`cbwebca_bd01`.`objectif` join `cbwebca_bd01`.`type_objectif` on(`cbwebca_bd01`.`type_objectif`.`type_objectif_id` = `cbwebca_bd01`.`objectif`.`type_objectif_id`)) left join `cbwebca_bd01`.`objectif_personnel` on(`cbwebca_bd01`.`objectif_personnel`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` and `cbwebca_bd01`.`objectif_personnel`.`responsabilite` = \'R\')) left join `cbwebca_bd01`.`personnel` on(`cbwebca_bd01`.`personnel`.`personnel_id` = `cbwebca_bd01`.`objectif_personnel`.`personnel_id`)) left join `cbwebca_bd01`.`departement` on(`cbwebca_bd01`.`departement`.`departement_id` = `cbwebca_bd01`.`personnel`.`departement_id`)) left join `cbwebca_bd01`.`direction` on(`cbwebca_bd01`.`direction`.`direction_id` = `cbwebca_bd01`.`departement`.`direction_id`)) left join `cbwebca_bd01`.`objectif_valeur` on(`cbwebca_bd01`.`objectif_valeur`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` and `cbwebca_bd01`.`objectif_valeur`.`objectif_valeur_id` = (select `cbwebca_bd01`.`objectif_valeur`.`objectif_valeur_id` from `cbwebca_bd01`.`objectif_valeur` where `cbwebca_bd01`.`objectif_valeur`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` order by `cbwebca_bd01`.`objectif_valeur`.`effectif_date` desc limit 1))) left join `cbwebca_bd01`.`v_objectif_budget_par_objectif` `objectif_budget` on(`objectif_budget`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id`)) left join `cbwebca_bd01`.`objectif_reddition` on(`cbwebca_bd01`.`objectif_reddition`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` and `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id` = (select `cbwebca_bd01`.`objectif_reddition`.`objectif_reddition_id` from `cbwebca_bd01`.`objectif_reddition` where `cbwebca_bd01`.`objectif_reddition`.`objectif_id` = `cbwebca_bd01`.`objectif`.`objectif_id` order by `cbwebca_bd01`.`objectif_reddition`.`reddition_date` desc limit 1))) left join `cbwebca_bd01`.`statut` on(`cbwebca_bd01`.`statut`.`statut_id` = `cbwebca_bd01`.`objectif_reddition`.`z_statut_id`)) order by `cbwebca_bd01`.`type_objectif`.`code`,`cbwebca_bd01`.`objectif`.`code`
mariadb-version=100508
